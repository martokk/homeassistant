  - platform: template
    sensors:

      ##########################################
      ########## INDOOR WEATHER ################
      ##########################################
      indoor_temperature:
        friendly_name: "Indoor Temperature"
        unit_of_measurement: 'ÂºF'
        value_template: >-
          {% set temp = 0.0 %}
          {% set c = 0 %}
          {% if states.sensor.kitchen_temperature %}
            {% if states.sensor.kitchen_temperature.state | float > 1.0 %}
              {% if (as_timestamp(now())-as_timestamp(states.sensor.kitchen_temperature.last_changed)) > (10 * 60)  %}
                {% set temp = temp + states.sensor.kitchen_temperature.state | float %}
                {% set c = c + 1 %}
              {% endif %}
            {% endif %}
          {% endif %}
          {% if states.sensor.tables_temperature %}
            {% if states.sensor.tables_temperature.state | float > 1.0 %}
              {% if (as_timestamp(now())-as_timestamp(states.sensor.tables_temperature.last_changed)) > (10 * 60)  %}
                {% set temp = temp + states.sensor.tables_temperature.state | float %}
                {% set c = c + 1 %}
              {% endif %}
            {% endif %}
          {% endif %}
          {% if states.sensor.entertainment_center_temperature %}
            {% if states.sensor.entertainment_center_temperature.state | float > 1.0 %}
              {% if (as_timestamp(now())-as_timestamp(states.sensor.entertainment_center_temperature.last_changed)) > (10 * 60)  %}
                {% set temp = temp + states.sensor.entertainment_center_temperature.state | float %}
                {% set c = c + 1 %}
              {% endif %}
            {% endif %}
          {% endif %}
          {% if states.sensor.bedroom_temperature %}
            {% if (as_timestamp(now())-as_timestamp(states.sensor.bedroom_temperature.last_changed)) > (10 * 60)  %}
              {% if states.sensor.bedroom_temperature.state | float > 1.0 %}
                {% set temp = temp + states.sensor.bedroom_temperature.state | float %}
                {% set c = c + 1 %}
              {% endif %}
            {% endif %}
          {% endif %}
          {% if c > 0 %}
           {{ (temp / c) | round(1) }}
          {% endif %}

      indoor_humidity:
        friendly_name: "Indoor Humidity"
        unit_of_measurement: '%'
        value_template: >-
          {% set humidity = 0.0 %}
          {% set c = 0 %}
          {% if states.sensor.kitchen_humidity %}
            {% if states.sensor.kitchen_humidity.state | float > 1.0 %}
              {% if (as_timestamp(now())-as_timestamp(states.sensor.kitchen_humidity.last_changed)) > (10 * 60)  %}
                {% set humidity = humidity + states.sensor.kitchen_humidity.state | float %}
                {% set c = c + 1 %}
              {% endif %}
            {% endif %}
          {% endif %}
          {% if states.sensor.tables_humidity %}
            {% if states.sensor.tables_humidity.state | float > 1.0 %}
              {% if (as_timestamp(now())-as_timestamp(states.sensor.tables_humidity.last_changed)) > (10 * 60)  %}
                {% set humidity = humidity + states.sensor.tables_humidity.state | float %}
                {% set c = c + 1 %}
              {% endif %}
            {% endif %}
          {% endif %}
          {% if states.sensor.entertainment_center_humidity %}
            {% if states.sensor.entertainment_center_humidity.state | float > 1.0 %}
              {% if (as_timestamp(now())-as_timestamp(states.sensor.entertainment_center_humidity.last_changed)) > (10 * 60)  %}
                {% set humidity = humidity + states.sensor.entertainment_center_humidity.state | float %}
                {% set c = c + 1 %}
              {% endif %}
            {% endif %}
          {% endif %}
          {% if states.sensor.bedroom_humidity %}
            {% if states.sensor.bedroom_humidity.state | float > 1.0 %}
              {% if (as_timestamp(now())-as_timestamp(states.sensor.bedroom_humidity.last_changed)) > (10 * 60)  %}
                {% set humidity = humidity + states.sensor.bedroom_humidity.state | float %}
                {% set c = c + 1 %}
              {% endif %}
            {% endif %}
          {% endif %}
          {% if c > 0 %}
           {{ (humidity / c) | round(1) }}
          {% endif %}





      ##########################################
      ########## DEVICES #######################
      ##########################################
      iphone6s_battery:
        friendly_name: "iPhone6s"
        unit_of_measurement: '%'
        value_template: >-
            {%- if states.device_tracker.iphone6s %}
                {{ states.device_tracker.iphone6s.attributes.battery }}
            {%- endif %}

      ipad_battery:
        friendly_name: "iPad"
        unit_of_measurement: '%'
        value_template: >-
            {%- if states.device_tracker.ipad %}
                {{ states.device_tracker.ipad.attributes.battery }}
            {% else %}

            {%- endif %}

      watch_battery:
        friendly_name: "Apple Watch"
        unit_of_measurement: '%'
        value_template: >-
            {%- if states.device_tracker.watch %}
                {{ states.device_tracker.watch.attributes.battery }}
            {% else %}

            {%- endif %}

      ##########################################
      ########## UPCOMING EVENTS ###############
      ##########################################
      upcoming_packers_event:
        friendly_name: 'Packers Game'
        value_template: >-
            {%- if states.calendar.green_bay_packers %}
                {{ states.calendar.green_bay_packers.attributes.message }}
            {% else %}

            {%- endif %}

      upcoming_packers_start_time:
        value_template: >-
            {%- if states.calendar.green_bay_packer %}
                {{ states.calendar.green_bay_packers.attributes.start_time }}
            {% else %}

            {%- endif %}

      upcoming_bears_event:
        friendly_name: 'Bears Game'
        value_template: >-
            {%- if states.calendar.chicago_bears %}
                {{ states.calendar.chicago_bears.attributes.message }}
            {% else %}

            {%- endif %}

      upcoming_bears_start_time:
        value_template: >-
            {%- if states.calendar.chicago_bears %}
                {{ states.calendar.chicago_bears.attributes.start_time }}
            {% else %}

            {%- endif %}

      upcoming_twit_event:
        friendly_name: 'Twit.tv '
        value_template: >-
            {%- if states.calendar.twit_live_schedule %}
                {{ states.calendar.twit_live_schedule.attributes.message }}
            {% else %}

            {%- endif %}

      upcoming_twit_start_time:
        value_template: >-
            {%- if states.calendar.twit_live_schedule %}
                {{ states.calendar.twit_live_schedule.attributes.start_time }}
            {% else %}

            {%- endif %}


      ##########################################
      ########## BITCOIN #######################
      ##########################################
      bitcoin_percent_change_24h:
        friendly_name: 'Percent Change 24h'
        value_template: >-
            {%- if states.sensor.bitcoin %}
                {{ states.sensor.bitcoin.attributes.percent_change_24h }}
            {% else %}

            {%- endif %}
        unit_of_measurement: '%'

      bitcoin_percent_change_7d:
        friendly_name: 'Percent Change 7d'
        value_template: >-
            {%- if states.sensor.bitcoin %}
                {{ states.sensor.bitcoin.attributes.percent_change_7d }}
            {% else %}

            {%- endif %}
        unit_of_measurement: '%'


      weather_alert:
        friendly_name: 'Weather Alerts'
        value_template: >-
          {% set criteria = ["Tornado Warning", "Tornado Watch", "Severe Thunderstorm Warning", "Flood Warning", "Severe Weather Statement", "Severe Thunderstorm Watch", "HUR", "TOR", "TOW", "WRN", "SEW", "FLO", "WAT", "SVR"] %}
          {% if states.sensor.pws_alerts %}
            {% for state in states.sensor.pws_alerts.attributes -%}
              {% if "Description" in state | string %}
                {% set description = states.sensor.pws_alerts.attributes[state] | string %}
                {% for item in criteria %}
                  {% if item in description %}
                    {{ description }}
                  {% else %}
                  {% endif -%}
                {%endfor%}
              {%endif%}
            {%- endfor -%}
          {% endif %}
      ##########################################
      ########## MEDIA PLAYER ##################
      ##########################################

      chromecast_playing_app:
        friendly_name: "Chromecast Playing App"
        value_template: '{% if states("media_player.vtv_chromecast") %}{{ states.media_player.vtv_chromecast.attributes.app_name }}{% else %}OFFLINE{% endif %}'

      ##########################################
      ########## SERVER ########################
      ##########################################

      # pihole_queries_blocked_today:
      #   friendly_name: "DNS Queries Blocked Today"
      #   value_template: >-
      #       {%- if states.sensor.pihole.state %}
      #           {{ states.sensor.pihole.state }}
      #       {% else %}
      #           0
      #       {%- endif %}
      #
      # pihole_queries_today:
      #   friendly_name: "DNS Queries Today"
      #   value_template: >-
      #       {%- if states.sensor.pihole.attributes.queries_today  %}
      #           {{ states.sensor.pihole.attributes.queries_today }}
      #       {% else %}
      #           0
      #       {%- endif %}
      #
      # pihole_percentage_today:
      #   friendly_name: "Today's Percentaged Blocked"
      #   unit_of_measurement: '%'
      #   value_template: >-
      #       {%- if states.sensor.pihole.attributes.percentage_today %}
      #           {{ states.sensor.pihole.attributes.percentage_today }}
      #       {% else %}
      #           0
      #       {%- endif %}
      #
      # pihole_domains_blocked:
      #   friendly_name: "Domains Being Blocked"
      #   value_template: >-
      #       {%- if states.sensor.pihole.attributes.domains_blocked %}
      #           {{ states.sensor.pihole.attributes.domains_blocked }}
      #       {% else %}
      #           0
      #       {%- endif %}

      server_sabnzbd:
        friendly_name: "SABnzbd"
        value_template: '{% if is_state("binary_sensor.sabnzbd", "on") %}online{% else %}OFFLINE{% endif %}'

      server_qbittorrent:
        friendly_name: "qBittorrent"
        value_template: '{% if is_state("binary_sensor.qbittorrent", "on") %}online{% else %}OFFLINE{% endif %}'

      server_sonarr:
        friendly_name: "Sonarr"
        value_template: '{% if is_state("binary_sensor.sonarr", "on") %}online{% else %}OFFLINE{% endif %}'

      server_couchpotato:
        friendly_name: "CouchPotato"
        value_template: '{% if is_state("binary_sensor.couchpotato", "on") %}online{% else %}OFFLINE{% endif %}'

      # server_pihole:
      #   friendly_name: "Pi-Hole"
      #   value_template: '{% if is_state("device_tracker.pihole", "home") %}online{% else %}OFFLINE{% endif %}'

      server_modem:
        friendly_name: "ARRIS Modem"
        value_template: '{% if is_state("binary_sensor.arris_modem", "on") %}online{% else %}OFFLINE{% endif %}'

      server_router:
        friendly_name: "Linksys DD-WRT Router"
        value_template: '{% if is_state("binary_sensor.linksys_ddwrt_router", "on") %}online{% else %}OFFLINE{% endif %}'

      server_mqtt:
        friendly_name: "MQTT Server"
        value_template: '{% if is_state("binary_sensor.mqtt_server", "on") %}online{% else %}OFFLINE{% endif %}'

      ##################################
      ######### CLOUD TEMPLATES ########
      ##################################

      # cloud_ifttt:
      #   friendly_name: "IFTTT Cloud"
      #   value_template: '{% if "Operational" in states("sensor.ifttt_status") %}online{% else %}Unknown{% endif %}'

      ##################################
      ########### IOT TEMPLATES ########
      ##################################

      iot_echo_dot:
        friendly_name: "Echo Dot"
        value_template: '{% if is_state("device_tracker.echo_dot", "home") %}online{% else %}OFFLINE{% endif %}'

      iot_esp8266_kitchen:
        friendly_name: "ESP8266 - Kitchen"
        value_template: '{% if is_state("device_tracker.esp8266_kitchen", "home") %}online{% else %}OFFLINE{% endif %}'

      iot_esp8266_office:
        friendly_name: "ESP8266 - Office"
        value_template: '{% if is_state("device_tracker.esp8266_office", "home") %}online{% else %}OFFLINE{% endif %}'

      iot_esp8266_tables:
        friendly_name: "ESP8266 - Tables"
        value_template: '{% if is_state("device_tracker.esp8266_tables", "home") %}online{% else %}OFFLINE{% endif %}'

      iot_esp8266_entertainment_center:
        friendly_name: "ESP8266 - Entertainment Center"
        value_template: '{% if is_state("device_tracker.esp8266_entertainment_center", "home") %}online{% else %}OFFLINE{% endif %}'

      iot_esp8266_bedroom:
        friendly_name: "ESP8266 - Bedroom"
        value_template: '{% if is_state("device_tracker.esp8266_bedroom", "home") %}online{% else %}OFFLINE{% endif %}'

      ###############################
      #### VHOME STATUS ALERTS ######
      ###############################

      server_status_alert:
        friendly_name: 'Server Status'
        value_template: >
          {% for server in states.group.server_status.attributes.entity_id -%}
            {%if is_state(server, "online") %}
            {%else%}
              {{ server }} - {{ states(server) }};
            {%endif%}
          {%- endfor -%}

      # cloud_status_alert:
      #   friendly_name: 'Cloud Status'
      #   value_template: >
      #     {% for cloud in states.group.cloud_status.attributes.entity_id -%}
      #       {%if is_state(cloud, "online") %}
      #       {%else%}
      #         {{ cloud }} - {{ states(cloud) }};
      #       {%endif%}
      #     {%- endfor -%}

      iot_status_alert:
        friendly_name: 'IoT Status'
        value_template: >
          {% for iot in states.group.iot_status.attributes.entity_id -%}
            {%if is_state(iot, "online") %}
            {%else%}
              {{ iot }} - {{ states(iot) }};
            {%endif%}
          {%- endfor -%}

      sonarr_upcoming_episodes:
        friendly_name: "Upcoming Episodes"
        value_template: >
          {% if states.sensor.sonarr_upcoming %}
            {% if states.sensor.sonarr_upcoming.state | int > 0 %}
              {% for episode in states.sensor.sonarr_upcoming.attributes %}
                {% if "icon" not in episode | string and "unit_of_measurement" not in episode | string  and "friendly_name"  not in episode | string %}
                  {{episode}} |
                {%endif %}
              {% endfor %}
            {% endif %}
          {% endif %}
