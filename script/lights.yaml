##########################################
##########  SCENEGEN #####################
##########################################
  scenegen:
    alias: "SceneGen: Save Scene"
    sequence:
    - service: shell_command.scenegen

##########################################
########## EFFECTS #######################
##########################################
  5m_flood_day:
    sequence:
    - service: script.flood_scene
      data:
        flood_scene: scene.day
        delay: "00:05:00"

##########################################
########## LAST KNOW SCENE ###############
##########################################
  call_last_known_scene:
    sequence:
    - service: scene.turn_on
      data_template:
        entity_id: 'scene.{{ states("input_select.var_last_known_scene") | replace(" ", "_") | lower }}'
    - delay: "00:00:00"
    - service: mqtt.publish
      data_template:
        topic: "device/office/led1/effect"
        payload: >
          {% for opt in states.input_select.office_led_effect.attributes.options -%}
            {% if states.input_select.office_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
    - service: mqtt.publish
      data_template:
        topic: "device/kitchen/led1/effect"
        payload: >
          {% for opt in states.input_select.kitchen_led_effect.attributes.options -%}
            {% if states.input_select.kitchen_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
    - service: mqtt.publish
      data_template:
        topic: "device/tables/led1/effect"
        payload: >
          {% for opt in states.input_select.tables_led_effect.attributes.options -%}
            {% if states.input_select.tables_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
    - service: mqtt.publish
      data_template:
        topic: "device/entertainment_center/led1/effect"
        payload: >
          {% for opt in states.input_select.entertainment_center_led_effect.attributes.options -%}
            {% if states.input_select.entertainment_center_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
    - service: mqtt.publish
      data_template:
        topic: "device/bedroom/led1/effect"
        payload: >
          {% for opt in states.input_select.bedroom_led_effect.attributes.options -%}
            {% if states.input_select.bedroom_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}

  call_last_known_scene_0s:
    sequence:
    - service: scene.turn_on
      data_template:
        entity_id: 'scene.0s_{{ states("input_select.var_last_known_scene") | replace(" ", "_") | lower }}'
    - delay: "00:00:00"
    - service: mqtt.publish
      data_template:
        topic: "device/office/led1/effect"
        payload: >
          {% for opt in states.input_select.office_led_effect.attributes.options -%}
            {% if states.input_select.office_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
    - service: mqtt.publish
      data_template:
        topic: "device/kitchen/led1/effect"
        payload: >
          {% for opt in states.input_select.kitchen_led_effect.attributes.options -%}
            {% if states.input_select.kitchen_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
    - service: mqtt.publish
      data_template:
        topic: "device/tables/led1/effect"
        payload: >
          {% for opt in states.input_select.kitchen_led_effect.attributes.options -%}
            {% if states.input_select.kitchen_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
    - service: mqtt.publish
      data_template:
        topic: "device/entertainment_center/led1/effect"
        payload: >
          {% for opt in states.input_select.entertainment_center_led_effect.attributes.options -%}
            {% if states.input_select.entertainment_center_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
    - service: mqtt.publish
      data_template:
        topic: "device/bedroom/led1/effect"
        payload: >
          {% for opt in states.input_select.bedroom_led_effect.attributes.options -%}
            {% if states.input_select.bedroom_led_effect.state | string == opt %}
              {{loop.index - 1}}
            {%endif%}
          {%- endfor -%}
