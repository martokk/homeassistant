##########################################
##########  TEST NOTIFY2 #################
##########################################
  notify2_test:
    sequence:
      - service: script.notify2
        data:
          telegram_message: |
            Remind Me to Buy Milk (Sent to MLO Cloud)
          mlo_message: "Remind me to buy Milk (TEST: HA to MLO)"
          blink_color: "red"

##########################################
##########  MAIN NOTIFY2 #################
##########################################
  notify2:
    alias: "vHome Notify2"
    sequence:
    - condition: state
      entity_id: input_boolean.var_start_notifications_1m
      state: 'on'
    ### SMS Notifications
    - service_template: >
        {% if sms_message %}
          {% if is_state('input_boolean.option_notify2_sms', 'on') %}
            notify.sms
          {% else %}
            script.notify2_do_nothing
          {% endif %}
        {% else %}
          script.notify2_do_nothing
        {% endif %}
      data_template:
        message: "{{ sms_message }}"

    ### Email Notifications
    - service_template: >
        {% if email_message %}
          {% if is_state('input_boolean.option_notify2_email', 'on') %}
            notify.gmail
          {% else %}
            script.notify2_do_nothing
          {% endif %}
        {% else %}
          script.notify2_do_nothing
        {% endif %}
      data_template:
        message: "{{ email_message }}"

    ### MLO Notifications
    - service_template: >
        {% if mlo_message %}
          {% if is_state('input_boolean.option_notify2_mlo', 'on') %}
            notify.mlo
          {% else %}
            script.notify2_do_nothing
          {% endif %}
        {% else %}
          script.notify2_do_nothing
        {% endif %}
      data_template:
        title: "{{ mlo_message }}"
        message: ""

    ## Telegram Notifications
    - service_template: >
        {% if telegram_message %}
          {% if is_state('input_boolean.option_notify2_telegram', 'on') %}
            notify.telegram
          {% else %}
            script.notify2_do_nothing
          {% endif %}
        {% else %}
          script.notify2_do_nothing
        {% endif %}
      data_template:
        message: "{{ telegram_message }}"

    ## Telegram Picture Notifications
    - service_template: >
        {% if telegram_url %}
          {% if is_state('input_boolean.option_notify2_telegram', 'on') %}
            notify.telegram
          {% else %}
            script.notify2_do_nothing
          {% endif %}
        {% else %}
          script.notify2_do_nothing
        {% endif %}
      data_template:
        message: ''
        data:
          photo:
            url: "{{ telegram_url }}"

    ### CONDITION: MIKE is HOME
    - condition: state
      entity_id: input_boolean.var_mike_home
      state: 'on'

    ### TTS Notifications    #### INCOMEPLETE
    # - service_template: >
    #     {% if tts_message %}
    #       {% if is_state('input_boolean.option_notify2_tts', 'on') %}
    #         notify.tts
    #       {% endif %}
    #     {% endif %}
    #   data_template:
    #     tts_message: "{{ tts_message }}"

      ### Chromecast Media Notifications
    - service_template: >
        {% if chromecast_link %}
          {% if not chromecast_entity_id %}
            {% set chromecast_entity_id = 'media_player.vtv_chromecast' %}
          {% endif %}
          {% if is_state('input_boolean.option_notify2_chromecast', 'on') %}
            {% if not is_state('binary_sensor.ps3', 'on') %}
              {% if not is_state(chromecast_entity_id, 'playing') or not is_state(chromecast_entity_id, 'paused') or is_state_attr(chromecast_entity_id, 'app_name', 'Default Media Receiver') %}
                media_player.play_media
              {% else %}
                script.notify2_do_nothing
              {% endif %}
            {% else %}
              script.notify2_do_nothing
            {% endif %}
          {% else %}
            script.notify2_do_nothing
          {% endif %}
        {% else %}
          script.notify2_do_nothing
        {% endif %}
      data_template:
        entity_id: "{% if chromecast_entity_id %} {{ chromecast_entity_id }} {% else %} media_player.vtv_chromecast {% endif %}"
        media_content_type: video
        media_content_id: "{{ chromecast_link }}"

    ### Light Notifications
    - service_template: >
        {% if is_state('input_boolean.option_notify2_lights', 'on') %}

          {% if flood_color %}
            {% if blink_color %}
              {% if blink_color2 %}
                script.flood_and_blink2
              {% else %}
                script.flood_and_blink
              {% endif %}
            {% elif breathe_color %}
              script.flood_and_breathe
            {% elif next_scene %}
              script.flood_and_change_scene
            {% else %}
              script.flood_light
            {% endif %}

          {% elif blink_color %}
            {% if blink_color2 %}
              script.blink2_light
            {% else %}
              script.blink_light
            {% endif %}

          {% elif breathe_color %}
            script.breathe_light

          {% elif flash_color %}
            script.flash_light

          {% elif flood_scene %}
            script.flood_scene

          {% else %}
            script.notify2_do_nothing

          {% endif %}

        {% else %}
          script.notify2_do_nothing
        {% endif %}
      data_template:
        blink_color: "{{ blink_color }}"
        blink_color2: "{{ blink_color2 }}"
        breathe_color: "{{ breathe_color }}"
        flash_color: "{{ flash_color }}"
        flood_color: "{{ flood_color }}"
        flood_scene: "{{ flood_scene }}"
        delay: "{{ delay }}"
        entity_id: "{% if entity_id %}{{entity_id}}{% else %}group.all_lights{% endif %}"
        next_scene: "{{ next_scene }}"


  notify2_do_nothing:
    alias: "vHome Notify2: Do Nothing"
    sequence:
