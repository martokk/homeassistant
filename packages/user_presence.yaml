homeassistant:
  customize:
    device_tracker.ipad:
      hidden: true
    device_tracker.dans_iphone6:
      hidden: true
    input_boolean.var_mike_home:
      emulated_hue: true
      emulated_hue_name: "Mike's Home"
    input_boolean.var_dan_home:
      emulated_hue: true
      emulated_hue_name: "Dan's Home"
# switch:
# lights:
# binary_sensor:
# sensor:

automation:
##########################################
########## NOTIFICATIONS #################
##########################################

  #********** Resident Mike Home ***************************************#
  - alias: 'Mike Home - Theme Video'
    trigger:
      - platform: state
        entity_id: input_boolean.var_mike_home
        from: 'off'
        to: 'on'
    action:
    - delay: "00:00:02"
    - service: script.notify2
      data_template:
        chromecast_entity_id: media_player.vtv_chromecast
        chromecast_link: http://192.168.1.3:8123/local/battlestar_galactica_intro.mp4
        tts_entity_id: group.tts_devices
        tts_sound: 'intercom_ds9.mp3'
        tts_message: "Welcome home Mike!"

  #********** Resident Dan Home ***************************************#
  # - alias: 'Dan Home - Theme Video'
  #   trigger:
  #     - platform: state
  #       entity_id: input_boolean.var_dan_home
  #       from: 'off'
  #       to: 'on'
  #   action:
  #   - delay: "00:00:03"
  #   - service: script.notify2
  #     data_template:
  #       chromecast_entity_id: media_player.vtv_chromecast
  #       chromecast_link: http://192.168.1.3:8123/local/bushes_of_love.mp4
  #       tts_entity_id: group.tts_devices
  #       tts_sound: 'intercom_ds9.mp3'
  #       tts_message: "Welcome home Dan!"

  #********** Temp Dan Home ***************************************#
  - alias: 'Dan Home Notification'
    trigger:
    - platform: state
      entity_id: input_boolean.var_dan_home
      from: "off"
      to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
    action:
    - service: script.notify2
      data_template:
        telegram_message: |
          Dan's Here!
    - condition: template
      value_template: >
        {% if states.automation.dan_home_notification.attributes.last_triggered %}
          {% if (as_timestamp(now())-as_timestamp(states.automation.dan_home_notification.attributes.last_triggered)) > (8 * 60 * 60)  %}
            true
          {% endif %}
        {%else%}
          true
        {%endif%}
    - service: script.set_volume_14
    - service: script.notify2
      data_template:
        flood_color: "green"
        entity_id: group.ambient_lights
        delay: "00:00:04"
        tts_entity_id: group.tts_devices
        tts_sound: 'intercom_tos.mp3'
        tts_message: "Dan's is here!"
    - delay: "00:00:05"
    - service: script.notify2
      data_template:
        chromecast_entity_id: media_player.vtv_chromecast
        chromecast_link: http://192.168.1.3:8123/local/bushes_of_love.mp4



  - alias: dan_here_filler_task_reminder
    trigger:
      - platform: time
        after: '22:00:00'
    condition:
      - condition: state
        entity_id: input_boolean.var_dan_home
        state: 'on'
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
    action:
      - service: script.notify2
        data_template:
          telegram_message: "REMINDER: Do 5m Filler Tasks"



  - alias: 'Dan Home - Start Smoke Session'
    trigger:
    - platform: state
      entity_id: input_boolean.var_dan_home
      from: "off"
      to: "on"
      for:
        minutes: 25
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.var_smoke_session_on
      - delay: '00:30:00'
      - service: input_boolean.turn_off
        entity_id: input_boolean.var_smoke_session_on
      - delay: '02:30:00'
      - service: input_boolean.turn_on
        entity_id: input_boolean.var_smoke_session_on
      - delay: '00:30:00'
      - service: input_boolean.turn_off
        entity_id: input_boolean.var_smoke_session_on

##########################################
########## AUTOMATIONS ###################
##########################################

  #********** User Presence ***********#
  - alias: 'All Residents Away - Automations'
    trigger:
      - platform: state
        entity_id: group.residents
        from: 'on'
        to: 'off'
        for:
          minutes: 10
    action:
    - service: scene.turn_on
      entity_id: scene.off
    - service: homeassistant.turn_off
      entity_id: input_boolean.option_notify2_tts
    - service: homeassistant.turn_off
      entity_id: input_boolean.option_notify2_chromecast
    - service: homeassistant.turn_off
      entity_id: input_boolean.option_notify2_lights

  - alias: 'Any Residents Home - Automations'
    trigger:
      - platform: state
        entity_id: group.residents
        from: 'off'
        to: 'on'
    action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.option_notify2_tts
    - service: homeassistant.turn_on
      entity_id: input_boolean.option_notify2_chromecast
    - service: homeassistant.turn_on
      entity_id: input_boolean.option_notify2_lights
    - service: scene.turn_on
      entity_id: scene.day_bright
    - delay: "00:05:00"
    - service: script.timebased_scene


##########################################
########## SCRIPTS #######################
##########################################
# script:


input_boolean:
##########################################
########## STORED VARIABLES ##############
##########################################
  var_mike_home:
    icon: mdi:cellphone-iphone

  var_dan_home:
    icon: mdi:cellphone-iphone

##########################################
########## OPTIONS #######################
##########################################
