##########################################
########## SCRIPTS #######################
##########################################
script:
  call_last_known_scene: # [rooms, transition]
    sequence:
      # Living Room
      - service_template: >
          {% if not rooms or "all" in rooms or "livingroom" in rooms %}
            script.scene2_{{ states.input_select.var_lks_livingroom.state }}_livingroom
          {% else %}
            script.scene2_do_nothing
          {% endif %}
        data_template:
          transition: '{% if transition %} {{ transition }} {%else%} 1 {% endif %}'

      # Office
      - service_template: >
          {% if not rooms or "all" in rooms or "office" in rooms %}
            script.scene2_{{ states.input_select.var_lks_office.state }}_office
          {% else %}
            script.scene2_do_nothing
          {% endif %}
        data_template:
          transition: '{% if transition %} {{ transition }} {%else%} 1 {% endif %}'

      # Kitchen
      - service_template: >
          {% if not rooms or "all" in rooms or "kitchen" in rooms %}
            script.scene2_{{ states.input_select.var_lks_kitchen.state }}_kitchen
          {% else %}
            script.scene2_do_nothing
          {% endif %}
        data_template:
          transition: '{% if transition %} {{ transition }} {%else%} 1 {% endif %}'

      # Re-send Kitchen LED State
      - service: mqtt.publish
        data_template:
          topic: "device/kitchen/led1/power"
          payload: >
            {% if states.light.kitchen_led_strip.state == 'on' %}
              1
            {% else %}
              0
            {% endif %}

      # Re-send Kitchen LED Brightness
      - service: mqtt.publish
        data_template:
          topic: "device/kitchen/led1/brightness"
          payload: '{{ states.light.kitchen_led_strip.attributes.brightness }}'

      # Re-send Kitchen LED Effect
      - service: mqtt.publish
        data_template:
          topic: "device/kitchen/led1/effect"
          payload: >
            {% for opt in states.input_select.office_led_effect.attributes.options -%}
              {% if states.input_select.office_led_effect.state | string == opt %}
                {{loop.index - 1}}
              {%endif%}
            {%- endfor -%}

      # Bedroom
      - service_template: >
          {% if not rooms or "all" in rooms or "bedroom" in rooms %}
            script.scene2_{{ states.input_select.var_lks_bedroom.state }}_bedroom
          {% else %}
            script.scene2_do_nothing
          {% endif %}
        data_template:
          transition: '{% if transition %} {{ transition }} {%else%} 1 {% endif %}'

##########################################
########## STORED VARIABLES ##############
##########################################

input_select:
  var_lks_livingroom:
    options:
      - "chill"
      - "chill_2"
      - "day"
      - "day_le"
      - "day_bright"
      - "night_blue"
      - "night_cyan"
      - "night_red"
      - "night"
      - "night_computer"
      - "night_computer_red"
      - "off"

  var_lks_office:
    options:
      - "chill"
      - "chill_2"
      - "day"
      - "day_le"
      - "day_bright"
      - "night_blue"
      - "night_cyan"
      - "night_red"
      - "night"
      - "night_computer"
      - "night_computer_red"
      - "off"

  var_lks_kitchen:
    options:
      - "chill"
      - "chill_2"
      - "day"
      - "day_le"
      - "day_bright"
      - "night_blue"
      - "night_cyan"
      - "night_red"
      - "night"
      - "night_computer"
      - "night_computer_red"
      - "off"

  var_lks_bedroom:
    options:
      - "chill"
      - "chill_2"
      - "day"
      - "day_le"
      - "day_bright"
      - "night_blue"
      - "night_cyan"
      - "night_red"
      - "night"
      - "night_computer"
      - "night_computer_red"
      - "off"

  var_lks_timebased:
    options:
      - "chill"
      - "chill_2"
      - "day"
      - "day_le"
      - "day_bright"
      - "night_blue"
      - "night_cyan"
      - "night_red"
      - "night"
      - "night_computer"
      - "night_computer_red"
      - "off"


##########################################
############### GROUPS ###################
##########################################
# group:
#   automation_devices:
#     entities:
#
#
#   script_devices:
#     entities:
