##########################################
############# BATTERY ####################
##########################################

  - alias: 'Battery Low Notification'
    trigger:
      - platform: numeric_state
        entity_id:
          - sensor.iphone6s_battery
          - sensor.ipad_battery
          - sensor.watch_battery
        below: 25
      - platform: numeric_state
        entity_id:
          - sensor.iphone6s_battery
          - sensor.ipad_battery
          - sensor.watch_battery
        below: 10
    action:
      - condition: template
        value_template: >
          {% if states.automation.battery_low_notification.attributes.last_triggered %}
            {% if (as_timestamp(now())-as_timestamp(states.automation.battery_low_notification.attributes.last_triggered)) > (1 * 30 * 60)  %}
              true
            {% else %}
              false
            {% endif %}
          {%else%}
            true
          {%endif%}
      - service: script.notify2
        data_template:
          sms_message: |
            Battery Low!
            iPhone: {{ states("sensor.iphone6s_battery") | int }}%  |  Watch: {{ states("sensor.watch_battery") | int  }}%  |  iPad: {{ states("sensor.ipad_battery") | int  }}%;
      - condition: template
        value_template: >
          {% if trigger.to_state.state | int <= 10 %}
            true
          {% endif %}
      - service: script.notify2
        data_template:
          sms_message: |
            Battery Low!
            iPhone: {{ states("sensor.iphone6s_battery") | int  }}%  |  Watch: {{ states("sensor.watch_battery") | int  }}%  |  iPad: {{ states("sensor.ipad_battery") | int  }}%;
          flood_color: "cyan"
          blink_color: "blueviolet"
          blink_color2: "red"


  - alias: 'Battery Fully Charged Email Only'
    trigger:
      - platform: state
        entity_id:
          - sensor.iphone6s_battery
          - sensor.watch_battery
        state: '100'
    action:
      - service: script.notify2
        data_template:
          sms_message: |
            Battery Fully Charged!
            iPhone: {{ states("sensor.iphone6s_battery") | int  }}%  |  Watch: {{ states("sensor.watch_battery") | int  }}%


  - alias: 'Battery Fully Charged Notificaiton'
    trigger:
      - platform: state
        entity_id:
          - sensor.iphone6s_battery
          - sensor.watch_battery
        state: '100'
        for:
          hours: 2
    action:
      - condition: time
        before: "23:59:59"
      - service: script.notify2
        data_template:
          sms_message: |
            Battery Fully Charged!
            iPhone: {{ states("sensor.iphone6s_battery") | int  }}%  |  Watch: {{ states("sensor.watch_battery") | int  }}%
          flood_color: "cyan"
          blink_color: "blueviolet"
          blink_color2: "green"

##########################################
########## DEVICE CONNECTED ##############
##########################################
  - alias: 'New Device Found'
    trigger:
      platform: event
      event_type: device_tracker_new_device
    action:
      - service: script.notify2
        data_template:
          sms_message: |
            New Device Found! Check Home Assistant's 'Known Devices'
