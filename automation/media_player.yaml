##########################################
########## SCREENSAVERS ##################
##########################################

  - alias: "Chromecast Screen Saver (Mark as Ready)"
    trigger:
      - platform: state
        entity_id: media_player.vtv_chromecast
        state: 'off'
        for:
          minutes: 5
      - platform: state
        entity_id: input_select.var_ps3_on
        state: 'off'
        for:
          minutes: 5
      - platform: state
        entity_id: media_player.entertainment_center
        state: 'on'
        for:
          minutes: 15
    condition:
      - condition: state
        entity_id: media_player.vtv_chromecast
        state: 'off'
      - condition: state
        entity_id: input_select.var_ps3_on
        state: 'off'
      - condition: state
        entity_id: media_player.entertainment_center
        state: 'on'
    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.var_chromecast_screensaver_ready

  - alias: "Chromecast Screen Saver (Mark as NOT Ready)"
    trigger:
      - platform: state
        entity_id: media_player.vtv_chromecast
        from: 'off'
      - platform: state
        entity_id: input_boolean.var_ps3_on
        state: 'off'
      - platform: event
        event_type: homeassistant_start
    action:
      - service: homeassistant.turn_off
        entity_id: input_boolean.var_chromecast_screensaver_ready

  - alias: "Chromecast Screen Saver"
    trigger:
      - platform: state
        entity_id: input_boolean.var_chromecast_screensaver_ready
        state: 'on'
    condition:
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - condition: state
        entity_id: switch.sonoff_entertainment_center
        state: 'on'
      - condition: state
        entity_id: input_boolean.var_ps3_on
        state: 'off'
      - condition: state
        entity_id: media_player.vtv_chromecast
        state: 'off'
      - condition: state
        entity_id: input_boolean.option_chromecast_screensaver
        state: 'on'
    action:
      # - condition: template
      #   value_template: >
      #     {% if is_state('media_player.vtv_chromecast', 'off') %}
      #       true
      #     {%endif%}
      - service: script.set_volume_4
      - service: script.turn_on
        data_template:
          entity_id: >
            {% set hour = states.sensor.time.state[:2] | int %}
            {% if hour | int < 5 %}
              script.media_scene_fireplace
            {% elif hour | int < 19 %}
              script.media_scene_magenta_blue_orbs_long
            {% elif hour | int < 23 %}
              script.media_scene_space
            {% elif hour | int >= 23 %}
              script.media_scene_fireplace
            {% endif %}
        # data_template:
        #   entity_id: >
        #     {% set random_number = range(1, 51) | random }
        #     {% if random_number == 1 %}
        #     {% elif random_number == 2 %}
        #     {% elif random_number == 3 %}
        #     {% endif %}

##########################################
##### DEFAULT MEDIA PLAYER - TURN OFF ####
##########################################

  - alias: "Default Media Player turn off"
    trigger:
      - platform: state
        entity_id: media_player.vtv_chromecast
        state: 'idle'
    condition:
      - condition: template
        value_template: '{% if states.media_player.vtv_chromecast.attributes.app_name == "Default Media Player" %}true{%else%}false{%endif%}'
    action:
      - service: media_player.turn_off
        entity_id: media_player.vtv_chromecast
