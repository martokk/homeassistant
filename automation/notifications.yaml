##########################################
########## GENERAL NOTIFICATIONS #########
##########################################

  # - alias: Update notifications
  #   trigger:
  #     - platform: state
  #       entity_id: updater.updater
  #   action:
  #     - service: notify.gmail
  #       data:
  #         message: 'There is a new Home Assistant release available.'
  #     - condition: state
  #       entity_id: input_boolean.var_mike_home
  #       state: 'on'
  #     - service: script.flood_and_blink
  #       data:
  #         flood_color: "cyan"
  #         blink_color: "orange"

##########################################
########## RESET BLIND NOTIFICATIONS #####
##########################################
  - alias: Reset Blind Notifications
    trigger:
      - platform: time
        hours: 3
        minutes: 0
        seconds: 0
    action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.option_blind_notifications


##########################################
############### BITCOIN  #################
##########################################

  - alias: Bitcoin Up
    trigger:
      - platform: numeric_state
        entity_id: sensor.bitcoin_percent_change_24h
        above: 2
    action:
      - service: notify.gmail
        data_template:
          message: |
            Bitcoin {{ states.sensor.bitcoin_percent_change_24h.state | round(1) }}% in 24h;

            Now:  ${{ states.sensor.bitcoin.state | round(2) }};
            7-Day: {{ states.sensor.bitcoin_percent_change_7d.state | round(1) }}%
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.flood_and_blink2
        data:
          flood_color: "blue"
          blink_color: "gold"
          blink_color2: "green"
      - condition: template
        value_template: >
          {% if states.media_player.vtv_chromecast.state | string == "playing" and "192.168" not in states.media_player.vtv_chromecast.attributes.media_content_id  %}
            false
          {%else%}
            true
          {%endif%}
      - service: media_player.play_media
        data:
          entity_id: media_player.vtv_chromecast
          media_content_type: video
          media_content_id: http://bitcoincharts.com/charts/chart.png?width=848&height=480&m=bitstampUSD&SubmitButton=Draw&r=1&i=5-min&c=0&s=&e=&Prev=&Next=&t=C&b=&a1=&m1=10&a2=&m2=25&x=0&i1=&i2=&i3=&i4=&v=1&cv=0&ps=0&l=0&p=0&

  - alias: Bitcoin Down
    trigger:
      - platform: numeric_state
        entity_id: sensor.bitcoin_percent_change_24h
        below: -2
    action:
      - service: notify.gmail
        data_template:
          message: |
            Bitcoin {{ states.sensor.bitcoin_percent_change_24h.state | round(1) }}% in 24h;

            Now:  ${{ states.sensor.bitcoin.state | round(2) }};
            7-Day: {{ states.sensor.bitcoin_percent_change_7d.state | round(1) }}%
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.flood_and_blink2
        data:
          flood_color: "blue"
          blink_color: "gold"
          blink_color2: "red"
      - condition: template
        value_template: >
          {% if states.media_player.vtv_chromecast.state | string == "playing" and "192.168" not in states.media_player.vtv_chromecast.attributes.media_content_id  %}
            false
          {%else%}
            true
          {%endif%}
      - service: media_player.play_media
        data:
          entity_id: media_player.vtv_chromecast
          media_content_type: video
          media_content_id: http://bitcoincharts.com/charts/chart.png?width=848&height=480&m=bitstampUSD&SubmitButton=Draw&r=1&i=5-min&c=0&s=&e=&Prev=&Next=&t=C&b=&a1=&m1=10&a2=&m2=25&x=0&i1=&i2=&i3=&i4=&v=1&cv=0&ps=0&l=0&p=0&

##########################################
############## INDOOR TEMP ######## ######
##########################################

  - alias: Indoor Temp (Hot)
    trigger:
      # - platform: numeric_state
      #   entity_id: sensor.kitchen_temperature
      #   above: 83
      - platform: template
        value_template: "{% if states.sensor.indoor_temperature.state | int > 81 %}true{%endif%}"
    action:
      - condition: state
        entity_id: input_boolean.var_start_notifications_1m
        state: 'on'
      - condition: template
        value_template: >
          {% if states.automation.indoor_temp_hot.attributes.last_triggered %}
            {% if (as_timestamp(now())-as_timestamp(states.automation.indoor_temp_hot.attributes.last_triggered)) > (2 * 60 * 60)  %}
              true
            {% endif %}
          {%else%}
            true
          {%endif%}
      - service: notify.gmail
        data_template:
          message: |
            It's HOT in here! -

            Indoor Temp: {{ states.sensor.indoor_temperature.state | round(1) }}°F.
            Kitchen Temp: {{ states.sensor.kitchen_temperature.state | round(1) }}°F.
            Tables Temp: {{ states.sensor.tables_temperature.state | round(1) }}°F.
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.blink_light
        data:
          blink_color: "red"
          entity_id: group.ambient_lights

  - alias: Indoor Temp (Cold)
    trigger:
      # - platform: numeric_state
      #   entity_id: sensor.kitchen_temperature
      #   below: 73
      - platform: template
        value_template: "{% if states.sensor.indoor_temperature.state | int < 72 %}true{%endif%}"
    action:
      - condition: state
        entity_id: input_boolean.var_start_notifications_1m
        state: 'on'
      - condition: template
        value_template: >
          {% if states.automation.indoor_temp_cold.attributes.last_triggered %}
            {% if (as_timestamp(now())-as_timestamp(states.automation.indoor_temp_cold.attributes.last_triggered)) > (2 * 60 * 60)  %}
              true
            {% endif %}
          {%else%}
            true
          {%endif%}
      - service: notify.gmail
        data_template:
          message: |
            It's COLD in here! -

            Indoor Temp: {{ states.sensor.indoor_temperature.state | round(1) }}°F.
            Kitchen Temp: {{ states.sensor.kitchen_temperature.state | round(1) }}°F.
            Tables Temp: {{ states.sensor.tables_temperature.state | round(1) }}°F.
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.blink_light
        data:
          blink_color: "deepskyblue"
          entity_id: group.ambient_lights

##########################################
############# BATTERY ####################
##########################################

  - alias: 'Battery Low Notification'
    trigger:
      # - platform: numeric_state
      #   entity_id:
      #     - sensor.iphone6s_battery
      #     - sensor.ipad_battery
      #     - sensor.watch_battery
      #   below: 35
      - platform: numeric_state
        entity_id:
          - sensor.iphone6s_battery
          - sensor.ipad_battery
          - sensor.watch_battery
        below: 25
      - platform: numeric_state
        entity_id:
          - sensor.iphone6s_battery
          - sensor.ipad_battery
          - sensor.watch_battery
        below: 10
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.var_mike_home
          state: 'on'
    action:
      - condition: state
        entity_id: input_boolean.var_start_notifications_1m
        state: 'on'
      - condition: template
        value_template: >
          {% if states.automation.battery_low_notification.attributes.last_triggered %}
            {% if (as_timestamp(now())-as_timestamp(states.automation.battery_low_notification.attributes.last_triggered)) > (1 * 60 * 60)  %}
              true
            {% else %}
              false
            {% endif %}
          {%else%}
            true
          {%endif%}
      - service: notify.gmail
        data_template:
          message: |
            Battery Low!

            iPhone: {{ states("sensor.iphone6s_battery") }}%;
            Watch: {{ states("sensor.watch_battery") }}%;
            iPad: {{ states("sensor.ipad_battery") }}%;
      - condition: template
        value_template: >
          {% if trigger.to_state.state | int <= 10 %}
            true
          {% endif %}
      - service: script.flood_and_blink2
        data:
          flood_color: "cyan"
          blink_color: "blueviolet"
          blink_color2: "red"


  - alias: 'Battery Fully Charged Email Only'
    trigger:
      - platform: state
        entity_id:
          - sensor.iphone6s_battery
          - sensor.watch_battery
        state: '100'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.var_mike_home
          state: 'on'
    action:
      - condition: state
        entity_id: input_boolean.var_start_notifications_1m
        state: 'on'
      - service: notify.gmail
        data_template:
          message: |
            Battery Fully Charged!

            iPhone: {{ states("sensor.iphone6s_battery") }}%;
            Watch: {{ states("sensor.watch_battery") }}%;
            iPad: {{ states("sensor.ipad_battery") }}%;


  - alias: 'Battery Fully Charged Notificaiton'
    trigger:
      - platform: state
        entity_id:
          - sensor.iphone6s_battery
          - sensor.watch_battery
        state: '100'
        for:
          hours: 2
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.var_mike_home
          state: 'on'
    action:
      - condition: time
        before: "23:59:59"
      - condition: state
        entity_id: input_boolean.var_start_notifications_1m
        state: 'on'
      - service: script.flood_and_blink2
        data:
          flood_color: "cyan"
          blink_color: "blueviolet"
          blink_color2: "green"
      - service: notify.gmail
        data_template:
          message: |
            Battery Fully Charged!

            iPhone: {{ states("sensor.iphone6s_battery") }}%;
            Watch: {{ states("sensor.watch_battery") }}%;
            iPad: {{ states("sensor.ipad_battery") }}%;

##########################################
############# VHOME NETWORK ##############
##########################################

  - alias: "Server Service Down"
    trigger:
      - platform: template
        value_template: >
          {% if states.sensor.server_status_alert.state != "" %}
            true
          {%else%}
            false
          {%endif%}
    action:
      - service: notify.gmail
        data_template:
          message: |
            Server Service Down! -

            {{ states.sensor.server_status_alert.state }}
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.flood_and_blink
        data:
          flood_color: "red"
          blink_color: "yellow"


  - alias: "Cloud Service Down"
    trigger:
      - platform: template
        value_template: >
          {% if states.sensor.cloud_status_alert.state != "" %}
            true
          {%else%}
            false
          {%endif%}
    action:
      - service: notify.gmail
        data_template:
          message: |
            Cloud Service Down! -

            {{ states.sensor.cloud_status_alert.state }}
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.flood_and_blink
        data:
          flood_color: "red"
          blink_color: "orange"


  - alias: "IoT Device Down"
    trigger:
      - platform: template
        value_template: >
          {% if states.sensor.iot_status_alert.state != "" %}
            true
          {%else%}
            false
          {%endif%}
    action:
      - service: notify.gmail
        data_template:
          message: |
            IoT Device Down! -

            {{ states.sensor.iot_status_alert.state }}
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.flood_and_blink
        data:
          flood_color: "red"
          blink_color: "blueviolet"


  - alias: "Disk Space Low"
    trigger:
      - platform: numeric_state
        entity_id: sensor.sabnzbd_disk_free
        below: 8
    action:
      - condition: template
        value_template: >
          {% if states.automation.disk_space_low.attributes.last_triggered %}
            {% if (as_timestamp(now())-as_timestamp(states.automation.disk_space_low.attributes.last_triggered)) > (2 * 60 * 60)  %}
              true
            {% else %}
              false
            {% endif %}
          {%else%}
            true
          {%endif%}
      - service: notify.gmail
        data_template:
          message: |
            V: Disk Space Low! -

            {{ states.sensor.sabnzbd_disk_free.state }}GB Free
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.flood_and_blink
        data:
          flood_color: "red"
          blink_color: "magenta"


  - alias: "SpeedTest Speed Low"
    trigger:
      - platform: numeric_state
        entity_id: sensor.speedtables_download
        below: 15
    action:
      - condition: template
        value_template: >
          {% if states.automation.speedtables_speed_low.attributes.last_triggered %}
            {% if (as_timestamp(now())-as_timestamp(states.automation.speedtables_speed_low.attributes.last_triggered)) > (2 * 60 * 60)  %}
              true
            {% else %}
              false
            {% endif %}
          {%else%}
            true
          {%endif%}
      - service: notify.gmail
        data_template:
          message: |
            Speed Test LOW! -

            {{ states.sensor.speedtables_download.state }}Mbit/s
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - service: script.flood_and_blink
        data:
          flood_color: "red"
          blink_color: "cyan"



  - alias: "Upcoming Episodes"
    trigger:
      - platform: numeric_state
        entity_id: sensor.sonarr_upcoming
        above: 0
    condition:
      - condition: time
        after: "21:00:00"
    action:
      - service: notify.gmail
        data_template:
          message: |
            Upcoming Episodes! -

            {% for episode in states.sensor.sonarr_upcoming.attributes %}
              {% if "icon" not in episode | string and "unit_of_measurement" not in episode | string  and "friendly_name"  not in episode | string %}
                {{episode}} |
              {%endif %}
            {% endfor %}
