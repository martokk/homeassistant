##########################################
########## DEVICE TRACKING ###############
##########################################

#********** Mike Presence ***************************************#
  - alias: 'Mike Away'
    trigger:
      - platform: state
        entity_id: device_tracker.iphone6s
        state: 'not_home'
        for:
          minutes: 10
    condition:
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
      - condition: state
        entity_id: device_tracker.dans_iphone6
        state: 'not_home'
    action:
      - service: homeassistant.turn_off
        entity_id: input_boolean.var_mike_home

  - alias: 'Mike Home'
    trigger:
      - platform: state
        entity_id: device_tracker.iphone6s
        state: 'home'
      - platform: state
        entity_id: device_tracker.watch
        state: 'home'
      - platform: state
        entity_id: device_tracker.dans_iphone6
        state: 'home'
    condition:
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'off'
    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.var_mike_home

#********** Dan Presence ***************************************#
  - alias: 'Dan Away'
    trigger:
      - platform: state
        entity_id: device_tracker.dans_iphone6
        state: 'not_home'
        for:
          minutes: 30
    condition:
      - condition: state
        entity_id: input_boolean.var_dan_home
        state: 'on'
    action:
      - service: homeassistant.turn_off
        entity_id: input_boolean.var_dan_home

  - alias: 'Dan Home'
    trigger:
      - platform: state
        entity_id: device_tracker.dans_iphone6
        state: 'home'
    condition:
      - condition: state
        entity_id: input_boolean.var_dan_home
        state: 'off'
    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.var_dan_home

##########################################
########## MQTT DEVICE CONNECTED #########
##########################################
  - alias: 'MQTT Device Connected - Call LKS'
    trigger:
      - platform: mqtt
        topic: device/kitchen/device
        payload: 'connected'
      - platform: mqtt
        topic: device/office/device
        payload: 'connected'
      - platform: mqtt
        topic: device/tables/device
        payload: 'connected'
      - platform: mqtt
        topic: device/entertainment_center/device
        payload: 'connected'
      - platform: mqtt
        topic: device/bedroom/device
        payload: 'connected'
    condition:
      - condition: state
        entity_id: input_boolean.var_mike_home
        state: 'on'
    action:
      - service: script.call_last_known_scene
      - service: script.notify2
        data:
          telegram_message: "ESP8266 device '{{ trigger.topic.split('/')[1] }}' connected."
